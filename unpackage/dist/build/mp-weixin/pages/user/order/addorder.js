(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/order/addorder"],{"1da2":function(t,e,o){"use strict";(function(t){o("e954");r(o("66fd"));var e=r(o("8cf9"));function r(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=o,t(e.default)}).call(this,o("543d")["createPage"])},"8cf9":function(t,e,o){"use strict";o.r(e);var r=o("b1af"),a=o("d11e");for(var i in a)"default"!==i&&function(t){o.d(e,t,(function(){return a[t]}))}(i);var n,s=o("f0c5"),u=Object(s["a"])(a["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],n);e["default"]=u.exports},b1af:function(t,e,o){"use strict";var r;o.d(e,"b",(function(){return a})),o.d(e,"c",(function(){return i})),o.d(e,"a",(function(){return r}));var a=function(){var t=this,e=t.$createElement,o=(t._self._c,t.__map(t.orderData.lists,(function(e,o){var r=t.__get_orig(e),a=t.__map(e.products,(function(e,o){var r=t.__get_orig(e),a=t.$flbooth.oss(e.image,77,77);return{$orig:r,g0:a}})),i=t.couponData[o]&&("reduction"==t.couponData[o].type||"vip"==t.couponData[o].type&&"reduction"==t.couponData[o].usertype)?Number(t.couponData[o].limit):null,n=t.couponData[o]&&("reduction"==t.couponData[o].type||"vip"==t.couponData[o].type&&"reduction"==t.couponData[o].usertype)?Number(t.couponData[o].price):null,s=t.couponData[o]&&("discount"==t.couponData[o].type||"vip"==t.couponData[o].type&&"discount"==t.couponData[o].usertype)?Number(t.couponData[o].limit):null,u=t.couponData[o]&&("discount"==t.couponData[o].type||"vip"==t.couponData[o].type&&"discount"==t.couponData[o].usertype)?Number(t.couponData[o].discount):null,c=t.couponData[o]&&"shipping"==t.couponData[o].type?Number(t.couponData[o].limit):null;return{$orig:r,l0:a,m0:i,m1:n,m2:s,m3:u,m4:c}}))),r=t.$flbooth.appstc("/coupon/bg_coupon_3x.png"),a=null!=t.couponIndex?t.__map(t.orderData.lists[t.couponIndex].coupon,(function(e,o){var r=t.__get_orig(e),a=e.state?t.$flbooth.appstc("/coupon/img_couponcentre_received_3x.png"):null,i="reduction"==e.type||"vip"==e.type&&"reduction"==e.usertype?Number(e.price):null,n="reduction"==e.type||"vip"==e.type&&"reduction"==e.usertype?Number(e.limit):null,s="reduction"==e.type||"vip"==e.type&&"reduction"==e.usertype?Number(e.price):null,u="discount"==e.type||"vip"==e.type&&"discount"==e.usertype?Number(e.discount):null,c="discount"==e.type||"vip"==e.type&&"discount"==e.usertype?Number(e.limit):null,d="discount"==e.type||"vip"==e.type&&"discount"==e.usertype?Number(e.discount):null,p="shipping"==e.type?Number(e.limit):null;return{$orig:r,g2:a,m5:i,m6:n,m7:s,m8:u,m9:c,m10:d,m11:p}})):null;t.$mp.data=Object.assign({},{$root:{l1:o,g1:r,l2:a}})},i=[]},b248:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=a(o("a34a"));function a(t){return t&&t.__esModule?t:{default:t}}function i(t,e,o,r,a,i,n){try{var s=t[i](n),u=s.value}catch(c){return void o(c)}s.done?e(u):Promise.resolve(u).then(r,a)}function n(t){return function(){var e=this,o=arguments;return new Promise((function(r,a){var n=t.apply(e,o);function s(t){i(n,r,a,s,u,"next",t)}function u(t){i(n,r,a,s,u,"throw",t)}s(void 0)}))}}var s={data:function(){return{loading:!1,token:"",optionData:{},addressData:{},modalName:null,cartType:null,couponData:{},couponIndex:null,orderData:{lists:[],statis:{allnum:1,allsub:0}}}},onLoad:function(t){this.optionData=JSON.parse(t.data),this.loadData(),this.cartType=t.type},methods:{loadData:function(t){var e=this;return n(r.default.mark((function o(){return r.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:e.$api.post({url:"/flbooth/order/getOrderGoodsList",loadingTip:"加载中",data:{data:e.optionData,address_id:t},success:function(t){e.token=t.token,e.orderData=t.orderData,t.addressData?e.addressData=t.addressData:e.addAddress("newadd")}});case 1:case"end":return o.stop()}}),o)})))()},addOrder:function(){var t=this;return n(r.default.mark((function e(){var o,a,i;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!==t.orderData.statis.allnum){e.next=3;break}return t.$flbooth.msg("订单异常"),e.abrupt("return");case 3:if(o=t.addressData.id,0!==o){e.next=7;break}return t.$flbooth.msg("请填写地址"),e.abrupt("return");case 7:a={lists:[],address_id:o},i=[],t.orderData.lists.forEach((function(e,o){a.lists.push({shop_id:e.shop_id,remarks:e.remarks,products:[],coupon_id:t.couponData[o]?t.couponData[o].id:0}),e.products.forEach((function(t){i.push({goods_id:t.id,sku_id:t.sku.id}),a.lists[o].products.push({goods_id:t.id,number:t.number,sku_id:t.sku.id,freight_id:t.freight_id})}))})),t.loading=!0,t.$api.post({url:"/flbooth/order/addOrder",data:{order:a,token:t.token},loadingTip:"提交订单中...",success:function(e){t.$store.commit("statistics/order",{pay:t.$store.state.statistics.order.pay+e.list.length,whole:t.$store.state.statistics.order.whole+e.list.length});var o=Object.keys(t.couponData).length;0!=o&&t.$store.commit("statistics/dynamic",{coupon:t.$store.state.statistics.dynamic.coupon-o}),"cart"==t.cartType&&t.$store.dispatch("cart/del"),t.$flbooth.to("/pages/user/money/pay?token=".concat(e.token,"&data=").concat(JSON.stringify(e.list)))}});case 11:case"end":return e.stop()}}),e)})))()},refreshList:function(t,e){var o=this;return n(r.default.mark((function e(){return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:o.$api.post({url:"/flbooth/address/address",data:{data:t,type:"add"},success:function(t){o.addressData=t}});case 1:case"end":return e.stop()}}),e)})))()},queryCoupon:function(t){var e=this;return n(r.default.mark((function o(){var a,i,n,s;return r.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(a=e.orderData.lists[t],0==a.coupon.length){for(i=[],n=[],s=0;s<a.products.length;s++)i.push(a.products[s]["id"]),n.push(a.products[s]["shop_category_id"]);e.$api.post({url:"/flbooth/coupon/query",data:{shop_id:a.shop_id,goods_id:e.unique(i),shop_category_id:e.unique(n),price:a.order_price},success:function(t){a.coupon=t}})}e.couponIndex=t,e.modalName="coupon";case 4:case"end":return o.stop()}}),o)})))()},onReceive:function(t){var e=this;return n(r.default.mark((function o(){var a;return r.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:a=e.orderData.lists[e.couponIndex].coupon[t],e.$api.post({url:"/flbooth/coupon/receive",loadingTip:"领取中",data:{id:a.id},success:function(t){a.id=t.id,a.state=!0,e.$flbooth.msg(t.msg),e.$store.commit("statistics/dynamic",{coupon:e.$store.state.statistics.dynamic.coupon+1})}});case 2:case"end":return o.stop()}}),o)})))()},onCoupons:function(t){var e=this.orderData.lists[this.couponIndex],o=this.orderData.lists[this.couponIndex].coupon;if(o[t].choice=!o[t].choice,o[t].choice){for(var r=0;r<o.length;r++)r!=t&&(o[r].choice=!1);if(this.couponData[this.couponIndex]=o[t],("reduction"==o[t].type||"vip"==o[t].type&&"reduction"==o[t].usertype)&&(e.freight.price=e.freight_price_bak,e.sub_price=this.$flbooth.bcsub(this.$flbooth.bcadd(e.order_price,e.freight.price),o[t].price),e.sub_price<0&&(e.sub_price=.01)),"discount"==o[t].type||"vip"==o[t].type&&"discount"==o[t].usertype){var a=o[t].discount>10?this.$flbooth.bcdiv(o[t].discount,100):this.$flbooth.bcdiv(o[t].discount,10);e.freight.price=e.freight_price_bak,e.sub_price=this.$flbooth.bcadd(this.$flbooth.bcmul(e.order_price,a),e.freight.price)}"shipping"==o[t].type&&(e.freight.price=0,e.sub_price=e.order_price)}else this.couponData={},"shipping"==o[t].type&&(e.freight.price=e.freight_price_bak),e.sub_price=this.$flbooth.bcadd(e.order_price,e.freight.price);this.orderData.statis.allsub=0;for(r=0;r<this.orderData.lists.length;r++)this.orderData.statis.allsub=this.$flbooth.bcadd(this.orderData.statis.allsub,this.orderData.lists[r].sub_price);this.modalName=null},changeNum:function(t){t=0==t?1:t,this.orderData.lists[0].number=t,this.orderData.lists[0].products[0].number=t,this.orderData.statis.allnum=t,this.orderData.lists[0].sub_price=this.$flbooth.bcmul(this.orderData.lists[0].products[0].sku.price,t),this.orderData.statis.allsub=this.$flbooth.bcmul(this.orderData.lists[0].products[0].sku.price,t)},addAddress:function(t){this.$flbooth.to("/pages/user/address/addressManage?type=".concat(t))},userAddress:function(){this.$flbooth.to("/pages/user/address/address?source=1")},showModal:function(t){this.modalName=t},hideModal:function(){this.modalName=null},unique:function(t){return Array.from(new Set(t)).join(",")},moveHandle:function(){}}};e.default=s},d11e:function(t,e,o){"use strict";o.r(e);var r=o("b248"),a=o.n(r);for(var i in r)"default"!==i&&function(t){o.d(e,t,(function(){return r[t]}))}(i);e["default"]=a.a}},[["1da2","common/runtime","common/vendor"]]]);