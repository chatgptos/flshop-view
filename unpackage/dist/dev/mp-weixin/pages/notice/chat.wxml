<view class="wanl-chat"><view class="edgeInsetTop"></view><view data-event-opts="{{[['touchstart',[['hideDrawer',['$event']]]]]}}" bindtouchstart="__e"><scroll-view class="cu-chat" scroll-y="true" scroll-with-animation="{{scrollAnimation}}" scroll-top="{{scrollTop}}" scroll-into-view="{{scrollToView}}" upper-threshold="50" data-event-opts="{{[['scrolltoupper',[['loadHistory',['$event']]]]]}}" bindscrolltoupper="__e"><view hidden="{{!(isHistoryLoading)}}" class="loading"><view class="spinner"><view class="rect1"></view><view class="rect2"></view><view class="rect3"></view><view class="rect4"></view><view class="rect5"></view></view></view><block wx:for="{{$root.l1}}" wx:for-item="row" wx:for-index="index" wx:key="index"><view id="{{'msg'+row.$orig.id}}"><block wx:if="{{row.$orig.type=='chat'}}"><view><block wx:if="{{row.$orig.to_id==to_id}}"><view class="cu-item self"><block wx:if="{{row.$orig.message.type=='text'}}"><view class="main"><view class="content bg-green"><rich-text nodes="{{row.$orig.message.content.text}}"></rich-text></view></view></block><block wx:if="{{row.$orig.message.type=='img'}}"><view class="main"><image style="{{'width:'+(row.$orig.message.content.w+'px')+';'+('height:'+(row.$orig.message.content.h+'px')+';')}}" src="{{row.$orig.message.content.url}}" data-event-opts="{{[['tap',[['showPic',['$0'],[[['msgList','',index,'message']]]]]]]}}" bindtap="__e"></image></view></block><block wx:if="{{row.$orig.message.type=='voice'}}"><view data-event-opts="{{[['tap',[['playVoice',['$0'],[[['msgList','',index,'message']]]]]]]}}" class="{{['main',playMsgid==row.$orig.message.id?'play':'']}}" bindtap="__e"><view class="action text-bold text-grey" style="padding-right:2rpx;">{{''+row.$orig.message.content.length+''}}<text class="wlIcon-miao"></text></view><view class="content bg-green"><text style="{{'width:'+(row.$orig.message.content.length*6+'rpx')+';'}}"></text><text class="wlIcon-yuyinyou text-xxl padding-left-xl"></text></view></view></block><block wx:if="{{row.$orig.message.type=='goods'}}"><view class="main goods"><view data-event-opts="{{[['tap',[['onGoods',['$0'],['goods.id']]]]]}}" class="content" bindtap="__e"><image src="{{row.g0}}" mode="widthFix"></image><view class="text-price text-orange text-lg margin-tb-xs">{{''+row.$orig.message.content.price+''}}</view><view>{{''+row.$orig.message.content.title+''}}</view></view></view></block><block wx:if="{{row.$orig.message.type=='order'}}"><view class="main order"><view data-event-opts="{{[['tap',[['orderDetails',['$0'],[[['msgList','',index,'message.content.id']]]]]]]}}" class="content" bindtap="__e"><view><text>订单详情：</text></view><view class="margin-tb-bj radius product padding-sm"><block wx:for="{{row.l0}}" wx:for-item="item" wx:for-index="index" wx:key="index"><view class="item"><view class="image"><image src="{{item.g1}}" mode="aspectFill"></image></view><view class="details text-sm"><view class="text-cut wanl-gray-dark"><text>{{item.$orig.title}}</text></view><view class="wanl-gray-light flex justify-between" style="width:100%;"><view class="text-price text-orange">{{''+item.$orig.price*item.$orig.number+''}}</view><view><text>{{item.$orig.difference+" x "+item.$orig.number}}</text><block wx:if="{{item.$orig.refund_status!=0}}"><text>{{"("+refundStatusText[item.$orig.refund_status]+")"}}</text></block></view></view></view></view></block></view><view class="text-sm flex justify-between "><view><text>{{stateText[row.$orig.message.content.state-1]}}</text></view><view><text>ID：</text><text>{{row.$orig.message.content.order_no}}</text></view></view></view></view></block><view class="cu-avatar radius" style="{{'background-image:'+('url('+row.g2+')')+';'}}"></view><view class="date">{{row.g3}}</view></view></block><block wx:else><view class="cu-item"><view class="cu-avatar radius" style="{{'background-image:'+('url('+row.g4+')')+';'}}"></view><block wx:if="{{row.$orig.message.type=='text'}}"><view class="main"><view class="content"><rich-text nodes="{{row.$orig.message.content.text}}"></rich-text></view></view></block><block wx:if="{{row.$orig.message.type=='img'}}"><view class="main"><image style="{{'width:'+(row.$orig.message.content.w+'px')+';'+('height:'+(row.$orig.message.content.h+'px')+';')}}" src="{{row.$orig.message.content.url}}" data-event-opts="{{[['tap',[['showPic',['$0'],[[['msgList','',index,'message']]]]]]]}}" bindtap="__e"></image></view></block><block wx:if="{{row.$orig.message.type=='voice'}}"><view data-event-opts="{{[['tap',[['playVoice',['$0'],[[['msgList','',index,'message']]]]]]]}}" class="{{['main',playMsgid==row.$orig.message.id?'play':'']}}" bindtap="__e"><view class="content"><text class="wlIcon-yuyinzuo text-xxl padding-right-xl"></text><text style="{{'width:'+(row.$orig.message.content.length*6+'rpx')+';'}}"></text></view><view class="action text-bold text-grey">{{''+row.$orig.message.content.length+''}}<text class="wlIcon-miao"></text></view></view></block><view class="date ">{{row.g5}}</view></view></block></view></block><block wx:if="{{row.$orig.type=='sys'}}"><view><view class="cu-info round">对方撤回一条消息!</view></view></block></view></block></scroll-view></view><view data-event-opts="{{[['touchmove',[['discard',['$event']]]]]}}" class="{{['popup-layer',(popupLayerClass)?'showLayer':'']}}" catchtouchmove="__e"><view class="{{[(hideEmoji)?'hidden':'']}}"><view class="emoji"><scroll-view class="emojinav" scroll-x="{{true}}" scroll-with-animation="{{true}}"><view class="item"><block wx:for="{{emojiList.categories}}" wx:for-item="item" wx:for-index="index" wx:key="index"><view class="{{[item==TabCur?'emojibg':'']}}" style="{{'background-image:'+('url('+emojiList.groups[item][0].url+')')+';'}}" data-id="{{item}}" data-event-opts="{{[['tap',[['tabSelect',['$event']]]]]}}" bindtap="__e"></view></block></view></scroll-view><block wx:for="{{emojiList.groups}}" wx:for-item="emoji" wx:for-index="groups" wx:key="groups"><block wx:if="{{TabCur==groups}}"><scroll-view class="subject" scroll-y="{{true}}" scroll-with-animation="{{true}}"><view class="item grid margin-bottom text-center col-5"><block wx:for="{{emoji}}" wx:for-item="item" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['addEmoji',['$0'],[[['emojiList.groups','',groups],['','',index,'value']]]]]]]}}" style="{{'background-image:'+('url('+item.url+')')+';'}}" bindtap="__e"></view></block></view></scroll-view></block></block></view></view><view class="{{['solid-top',(hideMore)?'hidden':'']}}"><view class="opmenu solid-top"><view data-event-opts="{{[['tap',[['browsing',['$event']]]]]}}" class="box" bindtap="__e"><view class="icon wanl-gray"><text class="wlIcon-shangpin"></text></view><text class="text-sm">商品</text></view><view data-event-opts="{{[['tap',[['order',['$event']]]]]}}" class="box" bindtap="__e"><view class="icon wanl-gray"><text class="wlIcon-dingdan1"></text></view><text class="text-sm">订单</text></view><view data-event-opts="{{[['tap',[['camera',['$event']]]]]}}" class="box" bindtap="__e"><view class="icon wanl-gray"><text class="wlIcon-31paishexuanzhong"></text></view><text class="text-sm">拍摄</text></view><view data-event-opts="{{[['tap',[['chooseImage',['$event']]]]]}}" class="box" bindtap="__e"><view class="icon wanl-gray"><text class="wlIcon-tupian1"></text></view><text class="text-sm">照片</text></view><view data-event-opts="{{[['tap',[['complaint',['$event']]]]]}}" class="box" bindtap="__e"><view class="icon wanl-gray"><text class="wlIcon-zhuyidapx"></text></view><text class="text-sm">投诉</text></view></view></view></view><view data-event-opts="{{[['touchmove',[['discard',['$event']]]]]}}" class="{{['input-box',(emptybottom)?'emptybottom':'',(popupLayerClass)?'showLayer':'']}}" catchtouchmove="__e"><view class="voice"><view data-event-opts="{{[['tap',[['switchVoice',['$event']]]]]}}" class="{{[isVoice?'wlIcon-jianpanqiehuan':'wlIcon-yuyin']}}" bindtap="__e"></view></view><view class="textbox"><view data-event-opts="{{[['touchstart',[['voiceBegin',['$event']]]],['touchmove',[['voiceIng',['$event']]]],['touchend',[['voiceEnd',['$event']]]],['touchcancel',[['voiceCancel',['$event']]]]]}}" class="{{['voice-mode',isVoice?'':'hidden',recording?'recording':'']}}" bindtouchstart="__e" catchtouchmove="__e" bindtouchend="__e" bindtouchcancel="__e">{{''+voiceTis+''}}</view><view class="{{['text-mode',isVoice?'hidden':'']}}"><view class="box"><textarea auto-height="true" maxlength="300" show-confirm-bar="{{false}}" cursor-spacing="90" data-event-opts="{{[['focus',[['textareaFocus',['$event']]]],['blur',[['textareaBlur',['$event']]]],['confirm',[['sendText',['$event']]]],['input',[['__set_model',['','textMsg','$event',[]]]]]]}}" value="{{textMsg}}" bindfocus="__e" bindblur="__e" bindconfirm="__e" bindinput="__e"></textarea></view><view data-event-opts="{{[['tap',[['chooseEmoji',['$event']]]]]}}" class="em" bindtap="__e"><view class="wlIcon-biaoqing2"></view></view></view></view><view data-event-opts="{{[['tap',[['showMore',['$event']]]]]}}" class="more" style="margin-right:-12rpx;" bindtap="__e"><view class="wlIcon-yuanquanjiahao"></view></view><view data-event-opts="{{[['tap',[['sendText',['$event']]]]]}}" class="{{['send',isVoice?'hidden':'']}}" bindtap="__e"><block wx:if="{{textMsg}}"><text class="wlIcon-zhifeiji"></text></block><block wx:else><text class="wlIcon-fasong"></text></block></view></view><block wx:if="{{goods&&isGoods}}"><view class="chatTips bg-white radius-bock margin-lr-bj padding-sm"><image class="radius" src="{{$root.g6}}" mode="aspectFill"></image><view class="details"><view class="flex justify-between margin-bottom-sm"><view class="text-cut title"><text>{{goods.title}}</text></view><view data-event-opts="{{[['tap',[['closeTips']]]]}}" bindtap="__e"><text class="wlIcon-31guanbi"></text></view></view><view class="flex justify-between"><view class="text-lg text-orange"><text class="text-price">{{goods.price}}</text></view><view><button data-event-opts="{{[['tap',[['sendGoods',['$0'],['goods']]]]]}}" class="cu-btn round bg-orange sm" bindtap="__e">发送商家</button></view></view></view></view></block><view class="{{['record',recording?'':'hidden']}}"><view class="{{['ing',willStop?'hidden':'']}}"><view class="wlIcon-huatong01"></view></view><view class="{{['cancel',willStop?'':'hidden']}}"><view class="wlIcon-shanchu2"></view></view><view class="{{['tis',willStop?'change':'']}}">{{recordTis}}</view></view><view class="WANL-MODAL"><view data-event-opts="{{[['tap',[['hideModal',['$event']]]]]}}" class="{{['cu-modal','bottom-modal',modalName=='goods'?'show':'']}}" bindtap="__e"><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="cu-dialog bg-white" catchtap="__e"><view class="wanl-modal"><view class="head padding-bj"><view class="content"><view class="text-lg">浏览过的商品</view></view><view data-event-opts="{{[['tap',[['hideModal',['$event']]]]]}}" class="close wlIcon-31guanbi" bindtap="__e"></view></view><scroll-view class="scroll-y" scroll-y="true"><block wx:for="{{$root.l2}}" wx:for-item="item" wx:for-index="index" wx:key="index"><view class="item goods"><block wx:if="{{item.$orig.goods!==null}}"><block><image class="radius" src="{{item.g7}}" mode="aspectFill"></image><view class="details"><view class="text-cut-2 title"><text>{{item.$orig.goods.title}}</text></view><view class="flex justify-between info"><view class="text-lg text-orange"><text class="text-price">{{item.$orig.goods.price}}</text></view><button data-event-opts="{{[['tap',[['sendGoods',['$0'],[[['goodsData','',index,'goods']]]]]]]}}" class="cu-btn round line-orange sm" bindtap="__e">发送商品</button></view></view></block></block></view></block></scroll-view><view class="foot padding-lr-bj"><button data-event-opts="{{[['tap',[['hideModal',['$event']]]]]}}" class="cu-btn bg-gradual-orange round text-bold complete" bindtap="__e">完成</button></view></view></view></view><view data-event-opts="{{[['tap',[['hideModal',['$event']]]]]}}" class="{{['cu-modal','bottom-modal',modalName=='order'?'show':'']}}" bindtap="__e"><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="cu-dialog bg-bgcolor" catchtap="__e"><view class="wanl-modal"><view class="head padding-bj"><view class="content"><view class="text-lg">购买过的订单</view></view><view data-event-opts="{{[['tap',[['hideModal',['$event']]]]]}}" class="close wlIcon-31guanbi" bindtap="__e"></view></view><scroll-view class="scroll-y" scroll-y="true"><block wx:for="{{$root.l4}}" wx:for-item="item" wx:for-index="index" wx:key="id"><view data-event-opts="{{[['tap',[['sendOrder',['$0'],[[['orderData','id',item.$orig.id]]]]]]]}}" class="item bg-white radius-bock margin-tb-sm padding-bj" bindtap="__e"><view class="flex justify-between"><text>{{"订单号："+item.$orig.order_no}}</text><text class="wanl-gray-dark text-sm">{{stateText[item.$orig.state-1]}}</text></view><block wx:for="{{item.l3}}" wx:for-item="goods" wx:for-index="key" wx:key="key"><view class="goods"><image class="radius" src="{{goods.g8}}" mode="aspectFill"></image><view class="details"><view class="text-cut-2 title wanl-gray-dark"><text>{{goods.$orig.title}}</text></view><view class="flex justify-between info"><view class="text-lg text-orange"><text class="text-price">{{goods.$orig.price}}</text></view></view></view></view></block><view class="flex justify-end"><button class="cu-btn round sm line-orange">发送订单</button></view></view></block></scroll-view><view class="foot padding-lr-bj"><button data-event-opts="{{[['tap',[['hideModal',['$event']]]]]}}" class="cu-btn bg-gradual-orange round text-bold complete" bindtap="__e">完成</button></view></view></view></view></view></view>