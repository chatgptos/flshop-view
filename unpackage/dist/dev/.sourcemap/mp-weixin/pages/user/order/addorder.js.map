{"version":3,"sources":["uni-app:///main.js","webpack:///D:/soft/fenglei/code/flshop/pages/user/order/addorder.vue?e868","webpack:///D:/soft/fenglei/code/flshop/pages/user/order/addorder.vue?1a33","webpack:///D:/soft/fenglei/code/flshop/pages/user/order/addorder.vue?84c6","webpack:///D:/soft/fenglei/code/flshop/pages/user/order/addorder.vue?278c","uni-app:///pages/user/order/addorder.vue"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page"],"mappings":";;;;;;;;;;kDAAA;;;AAGA;AACA,wG,8FAHA;AACAA,EAAE,CAACC,iCAAH,GAAuCC,mBAAvC,CAGAC,UAAU,CAACC,iBAAD,CAAV,C;;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;AAAA;AAAqH;AACrH;AAC4D;AACL;;;AAGvD;AACsK;AACtK,gBAAgB,0KAAU;AAC1B,EAAE,8EAAM;AACR,EAAE,mFAAM;AACR,EAAE,4FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,uFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AClIA;AAAA;AAAA;AAAA;AAAonB,CAAgB,mmBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC8LxoB;AACA,MADA,kBACA;AACA;AACA,oBADA;AAEA,eAFA;AAGA,oBAHA;AAIA,qBAJA;AAKA,qBALA,EAKA;AACA,oBANA;AAOA,oBAPA;AAQA,uBARA;AASA;AACA,iBADA;AAEA;AACA,mBADA;AAEA,mBAFA,EAFA,EATA;;;;AAiBA,GAnBA;AAoBA,QApBA,kBAoBA,MApBA,EAoBA;AACA;AACA;AACA;AACA,GAxBA;AAyBA;AACA,YADA,oBACA,UADA,EACA;AACA;AACA,yDADA;AAEA,mCAFA;AAGA;AACA,0CADA;AAEA,0CAFA,EAHA;;AAOA;AACA;AACA;AACA;AACA;AACA,qBAFA,MAEA;AACA;AACA;AACA,mBAfA,IADA;;AAkBA,KAnBA;AAoBA;AACA,YArBA,sBAqBA;AACA,oDADA;AAEA,4CAFA;;;AAKA,0BALA,GAKA,qBALA;AAMA,gCANA;AAOA,6CAPA;;;AAUA,oBAVA,GAUA,qCAVA;AAWA,oBAXA,GAWA,EAXA;AAYA;AACA;AACA,yCADA;AAEA,yCAFA;AAGA,gCAHA;AAIA;AACA,yFALA;;AAOA;AACA;AACA;AACA,wCADA;AAEA,0CAFA;;AAIA;AACA;AACA,wCADA;AAEA,0CAFA;AAGA,0CAHA;AAIA,kDAJA;;AAMA,mBAbA;AAcA,iBAtBA;AAuBA;AACA;AACA;AACA,gDADA;AAEA;AACA,+BADA;AAEA,uCAFA,EAFA;;AAMA,wCANA;AAOA;AACA;AACA,qFADA;AAEA,yFAFA;;AAIA;AACA;AACA;AACA;AACA,sFADA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,mBAxBA,IArCA;;AA+DA,KApFA;AAqFA;AACA,eAtFA,uBAsFA,IAtFA,EAsFA,IAtFA,EAsFA;AACA;AACA,iDADA;AAEA;AACA,8BADA;AAEA,+BAFA,EAFA;;AAMA;AACA;AACA,mBARA,IADA;;AAWA,KAjGA;AAkGA;AACA,eAnGA,uBAmGA,KAnGA,EAmGA;AACA,oBADA,GACA,6BADA;AAEA;AACA,0BADA,GACA,EADA;AAEA,kCAFA,GAEA,EAFA;AAGA;AACA;AACA;AACA;AACA;AACA,gDADA;AAEA;AACA,2CADA;AAEA,uDAFA;AAGA,uEAHA;AAIA,6CAJA,EAFA;;AAQA;AACA;AACA,qBAVA;;AAYA;AACA;AACA,4CAvBA;AAwBA,KA3HA;AA4HA;AACA,aA7HA,qBA6HA,KA7HA,EA6HA;AACA,sBADA,GACA,wDADA;AAEA;AACA,gDADA;AAEA,mCAFA;AAGA;AACA,iCADA,EAHA;;AAMA;AACA;AACA;AACA;AACA;AACA,+EADA;;AAGA,mBAbA,IAFA;;AAiBA,KA9IA;AA+IA;AACA,aAhJA,qBAgJA,KAhJA,EAgJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OA7BA,MA6BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KA/LA;AAgMA;AACA,aAjMA,qBAiMA,GAjMA,EAiMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAzMA;AA0MA,cA1MA,sBA0MA,IA1MA,EA0MA;AACA;AACA,KA5MA;AA6MA,eA7MA,yBA6MA;AACA;AACA,KA/MA;AAgNA;AACA,aAjNA,qBAiNA,IAjNA,EAiNA;AACA;AACA,KAnNA;AAoNA;AACA,aArNA,uBAqNA;AACA;AACA,KAvNA;AAwNA;AACA,UAzNA,kBAyNA,GAzNA,EAyNA;AACA;AACA,KA3NA;AA4NA;AACA,cA7NA,wBA6NA,EA7NA,EAzBA,E","file":"pages/user/order/addorder.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/user/order/addorder.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./addorder.vue?vue&type=template&id=4e568bc9&\"\nvar renderjs\nimport script from \"./addorder.vue?vue&type=script&lang=js&\"\nexport * from \"./addorder.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../hbuild/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/user/order/addorder.vue\"\nexport default component.exports","export * from \"-!../../../../../../hbuild/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../hbuild/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../hbuild/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../hbuild/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../hbuild/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../hbuild/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./addorder.vue?vue&type=template&id=4e568bc9&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l1 = _vm.__map(_vm.orderData.lists, function(shop, index) {\n    var $orig = _vm.__get_orig(shop)\n\n    var l0 = _vm.__map(shop.products, function(goods, key) {\n      var $orig = _vm.__get_orig(goods)\n\n      var g0 = _vm.$flbooth.oss(goods.image, 77, 77)\n      return {\n        $orig: $orig,\n        g0: g0\n      }\n    })\n\n    var m0 =\n      _vm.couponData[index] &&\n      (_vm.couponData[index].type == \"reduction\" ||\n        (_vm.couponData[index].type == \"vip\" &&\n          _vm.couponData[index].usertype == \"reduction\"))\n        ? Number(_vm.couponData[index].limit)\n        : null\n    var m1 =\n      _vm.couponData[index] &&\n      (_vm.couponData[index].type == \"reduction\" ||\n        (_vm.couponData[index].type == \"vip\" &&\n          _vm.couponData[index].usertype == \"reduction\"))\n        ? Number(_vm.couponData[index].price)\n        : null\n    var m2 =\n      _vm.couponData[index] &&\n      (_vm.couponData[index].type == \"discount\" ||\n        (_vm.couponData[index].type == \"vip\" &&\n          _vm.couponData[index].usertype == \"discount\"))\n        ? Number(_vm.couponData[index].limit)\n        : null\n    var m3 =\n      _vm.couponData[index] &&\n      (_vm.couponData[index].type == \"discount\" ||\n        (_vm.couponData[index].type == \"vip\" &&\n          _vm.couponData[index].usertype == \"discount\"))\n        ? Number(_vm.couponData[index].discount)\n        : null\n    var m4 =\n      _vm.couponData[index] && _vm.couponData[index].type == \"shipping\"\n        ? Number(_vm.couponData[index].limit)\n        : null\n    return {\n      $orig: $orig,\n      l0: l0,\n      m0: m0,\n      m1: m1,\n      m2: m2,\n      m3: m3,\n      m4: m4\n    }\n  })\n\n  var g1 = _vm.$flbooth.appstc(\"/coupon/bg_coupon_3x.png\")\n  var l2 =\n    _vm.couponIndex != null\n      ? _vm.__map(_vm.orderData.lists[_vm.couponIndex].coupon, function(\n          coupon,\n          index\n        ) {\n          var $orig = _vm.__get_orig(coupon)\n\n          var g2 = coupon.state\n            ? _vm.$flbooth.appstc(\"/coupon/img_couponcentre_received_3x.png\")\n            : null\n          var m5 =\n            coupon.type == \"reduction\" ||\n            (coupon.type == \"vip\" && coupon.usertype == \"reduction\")\n              ? Number(coupon.price)\n              : null\n          var m6 =\n            coupon.type == \"reduction\" ||\n            (coupon.type == \"vip\" && coupon.usertype == \"reduction\")\n              ? Number(coupon.limit)\n              : null\n          var m7 =\n            coupon.type == \"reduction\" ||\n            (coupon.type == \"vip\" && coupon.usertype == \"reduction\")\n              ? Number(coupon.price)\n              : null\n          var m8 =\n            coupon.type == \"discount\" ||\n            (coupon.type == \"vip\" && coupon.usertype == \"discount\")\n              ? Number(coupon.discount)\n              : null\n          var m9 =\n            coupon.type == \"discount\" ||\n            (coupon.type == \"vip\" && coupon.usertype == \"discount\")\n              ? Number(coupon.limit)\n              : null\n          var m10 =\n            coupon.type == \"discount\" ||\n            (coupon.type == \"vip\" && coupon.usertype == \"discount\")\n              ? Number(coupon.discount)\n              : null\n          var m11 = coupon.type == \"shipping\" ? Number(coupon.limit) : null\n          return {\n            $orig: $orig,\n            g2: g2,\n            m5: m5,\n            m6: m6,\n            m7: m7,\n            m8: m8,\n            m9: m9,\n            m10: m10,\n            m11: m11\n          }\n        })\n      : null\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l1: l1,\n        g1: g1,\n        l2: l2\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../hbuild/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../hbuild/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../hbuild/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../hbuild/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../hbuild/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./addorder.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../hbuild/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../hbuild/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../hbuild/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../hbuild/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../hbuild/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./addorder.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<view class=\"edgeInsetTop\"></view>\r\n\t\t<view class=\"wanl-order\"> \r\n\t\t\t<view class=\"address cu-list menu-avatar margin-bj radius-bock\">\r\n\t\t\t\t<view class=\"cu-item\">\r\n\t\t\t\t\t<view class=\"cu-avatar round wanl-bg-orange\"><text class=\"wlIcon-weizhi1\"></text></view>\r\n\t\t\t\t\t<view class=\"content\" v-if=\"addressData.address\" @tap=\"userAddress()\">\r\n\t\t\t\t\t\t<view>\r\n\t\t\t\t\t\t\t<text class=\"wanl-pip margin-right-sm\">{{ addressData.name }}</text>\r\n\t\t\t\t\t\t\t<text class=\"wanl-gray-light text-sm\">{{ addressData.mobile }}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"text-sm wanl-pip text-cut\">{{ addressData.province}} {{ addressData.city }} {{ addressData.district }} {{ addressData.address }}</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"content\" @tap=\"addAddress('newadd')\" v-else><view class=\"text-sm wanl-pip text-cut\">点击此处填写收货地址</view></view>\r\n\t\t\t\t\t<view class=\"action\"><text class=\"wlIcon-fanhui2 text-lg\"></text></view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view v-for=\"(shop, index) in orderData.lists\" :key=\"index\" class=\"lists bg-white margin-bj radius-bock\">\r\n\t\t\t\t<view class=\"shopname\">\r\n\t\t\t\t\t<text class=\"wlIcon-dianpu2 text-orange margin-right-sm\"></text>\r\n\t\t\t\t\t<text class=\"wanl-pip text-df\">{{ shop.shop_name }}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"cu-list menu-avatar\">\r\n\t\t\t\t\t<view class=\"cu-item margin-bottom\" v-for=\"(goods, key) in shop.products\" :key=\"key\">\r\n\t\t\t\t\t\t<view class=\"cu-avatar radius-bock\" :style=\"{ backgroundImage: 'url(' + $flbooth.oss(goods.image, 77, 77) + ')' }\"></view>\r\n\t\t\t\t\t\t<view class=\"content\">\r\n\t\t\t\t\t\t\t<view class=\"text-sm text-cut-2\">{{ goods.title }}</view>\r\n\t\t\t\t\t\t\t<view class=\"wanl_sku text-sm\">\r\n\t\t\t\t\t\t\t\t<text v-for=\"(item, skey) in goods.sku.difference\" :key=\"skey\">\r\n\t\t\t\t\t\t\t\t<block v-if=\"skey != 0\">-</block>{{ item }}\r\n\t\t\t\t\t\t\t\t</text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"action\">\r\n\t\t\t\t\t\t\t<view class=\"wanl-pip text-sm text-price\">{{ goods.sku.price }}</view>\r\n\t\t\t\t\t\t\t<view class=\"wanl-gray-light text-sm\">x{{ goods.number }}</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<form>\r\n\t\t\t\t\t<!-- <view class=\"cu-form-group\" v-if=\"cartType\">\r\n\t\t\t\t\t\t<view class=\"wanl-gray-light title\">购买数量</view>\r\n\t\t\t\t\t\t<uni-number-box :min=\"1\" :max=\"orderData.lists[0].products[0].sku.stock\" :value=\"shop.number\" @change=\"changeNum\"></uni-number-box>\r\n\t\t\t\t\t</view> -->\r\n\t\t\t\t\t<view class=\"cu-form-group\">\r\n\t\t\t\t\t\t<view class=\"wanl-gray-light title\">快递运费</view>\r\n\t\t\t\t\t\t<view class=\"picker\">{{shop.freight.name}} <text class=\"text-price margin-left-xs\">{{shop.freight.price}}</text></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"cu-form-group\" @tap=\"queryCoupon(index)\">\r\n\t\t\t\t\t\t<view class=\"wanl-gray-light title\">优惠折扣</view>\r\n\t\t\t\t\t\t<view class=\"picker\"> \r\n\t\t\t\t\t\t\t<block v-if=\"couponData[index]\">\r\n\t\t\t\t\t\t\t\t<text class=\"wlIcon-youhuiquantuangou text-red margin-right-xs\"></text>\r\n\t\t\t\t\t\t\t\t<block v-if=\"couponData[index].type == 'reduction' || (couponData[index].type == 'vip' && couponData[index].usertype == 'reduction')\">\r\n\t\t\t\t\t\t\t\t\t<text>满{{Number(couponData[index].limit)}}减</text> ￥{{Number(couponData[index].price)}}\r\n\t\t\t\t\t\t\t\t</block>\r\n\t\t\t\t\t\t\t\t<block v-if=\"couponData[index].type == 'discount' || (couponData[index].type == 'vip' && couponData[index].usertype == 'discount')\">\r\n\t\t\t\t\t\t\t\t\t<text>满{{Number(couponData[index].limit)}}打</text> {{Number(couponData[index].discount)}} 折\r\n\t\t\t\t\t\t\t\t</block>\r\n\t\t\t\t\t\t\t\t<block v-if=\"couponData[index].type == 'shipping'\">\r\n\t\t\t\t\t\t\t\t\t<text>满{{Number(couponData[index].limit)}}</text>包邮\r\n\t\t\t\t\t\t\t\t</block>\r\n\t\t\t\t\t\t\t</block>\r\n\t\t\t\t\t\t\t<block v-else>\r\n\t\t\t\t\t\t\t\t<text class=\"text-gray\">请选择</text>\r\n\t\t\t\t\t\t\t</block>\r\n\t\t\t\t\t\t\t<text class=\"wlIcon-fanhui2 margin-left\"></text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"cu-form-group align-start\">\r\n\t\t\t\t\t\t<view class=\"wanl-gray-light title\">备注</view>\r\n\t\t\t\t\t\t<textarea maxlength=\"-1\" v-model=\"shop.remarks\" placeholder=\"订单备注可选\"></textarea>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</form>\r\n\t\t\t\t<view class=\"text-right margin-bj text-sm\">\r\n\t\t\t\t\t<text class=\"wanl-gray\">共{{ shop.number }}件，</text>\r\n\t\t\t\t\t小计：\r\n\t\t\t\t\t<text class=\"text-price text-orange\">{{ shop.sub_price }}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"safeAreaBottom\"> </view>\r\n\t\t\t<!-- 弹出层 -->\r\n\t\t\t<view class=\"WANL-MODAL text-sm\" @touchmove.stop.prevent=\"moveHandle\">\r\n\t\t\t\t<!-- 优惠券 -->\r\n\t\t\t\t<view class=\"cu-modal bottom-modal\" :class=\"modalName == 'coupon' ? 'show' : ''\" @tap=\"hideModal\">\r\n\t\t\t\t\t<view class=\"cu-dialog bg-bgcolor\" @tap.stop=\"\">\r\n\t\t\t\t\t\t<view class=\"wanl-modal\">\r\n\t\t\t\t\t\t\t<view class=\"head padding-bj\">\r\n\t\t\t\t\t\t\t\t<view class=\"content\"><view class=\"text-lg\">优惠券</view></view>\r\n\t\t\t\t\t\t\t\t<view class=\"close wlIcon-31guanbi\" @tap=\"hideModal\"></view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<scroll-view class=\"wanl-coupon scroll-y\" scroll-y=\"true\" v-if=\"couponIndex != null\">\r\n\t\t\t\t\t\t\t\t<view v-for=\"(coupon, index) in orderData.lists[couponIndex].coupon\" :key=\"index\" :class=\"coupon.type\" class=\"item margin-bottom-bj radius-bock\">\r\n\t\t\t\t\t\t\t\t\t<image :src=\"$flbooth.appstc('/coupon/bg_coupon_3x.png')\" class=\"coupon-bg\"></image>\r\n\t\t\t\t\t\t\t\t\t<image :src=\"$flbooth.appstc('/coupon/img_couponcentre_received_3x.png')\" class=\"coupon-sign\" v-if=\"coupon.state\"></image>\r\n\t\t\t\t\t\t\t\t\t<view class=\"item-left\">\r\n\t\t\t\t\t\t\t\t\t\t<block v-if=\"coupon.type == 'reduction' || (coupon.type == 'vip' && coupon.usertype == 'reduction')\">\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"colour\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<text class=\"text-price\"></text>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<text class=\"prices\">{{Number(coupon.price)}}</text>\r\n\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"cu-tag wanl-gray-dark radius text-sm bg-white\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t满{{Number(coupon.limit)}}减{{Number(coupon.price)}}\r\n\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t</block>\r\n\t\t\t\t\t\t\t\t\t\t<block v-if=\"coupon.type == 'discount' || (coupon.type == 'vip' && coupon.usertype == 'discount')\">\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"colour\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<text class=\"prices\">{{Number(coupon.discount)}}</text>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<text class=\"discount\">折</text>\r\n\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"cu-tag wanl-gray-dark radius text-sm bg-white\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t满{{Number(coupon.limit)}}打{{Number(coupon.discount)}}折\r\n\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t</block>\r\n\t\t\t\t\t\t\t\t\t\t<block v-if=\"coupon.type == 'shipping'\">\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"colour\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<text class=\"prices\">包邮</text>\r\n\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"cu-tag wanl-gray-dark radius text-sm bg-white\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t满{{Number(coupon.limit)}}元包邮\r\n\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t</block>\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t<view class=\"item-right padding-bj\">\r\n\t\t\t\t\t\t\t\t\t\t<view class=\"title\">\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"cu-tag sm radius margin-right-xs tagstyle\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t{{coupon.type_text}}\r\n\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t<text class=\"text-cut wanl-gray text-min\">{{coupon.name}}</text>\r\n\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t<view class=\"content text-min\">\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"wanl-gray\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t<view v-if=\"coupon.grant != '-1'\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<text class=\"wlIcon-dot\"></text>目前仅剩余 {{coupon.surplus}} 张\r\n\t\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t<view v-if=\"coupon.drawlimit != 0\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<text class=\"wlIcon-dot\"></text>每人仅限领取 {{coupon.drawlimit}} 张\r\n\t\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<block v-if=\"coupon.pretype == 'fixed'\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<view>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<text class=\"wlIcon-dot\"></text>生效 {{coupon.startdate}}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<view>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<text class=\"wlIcon-dot\"></text>结束 {{coupon.enddate}}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</block>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<block v-if=\"coupon.pretype == 'appoint'\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<view v-if=\"coupon.validity == 0\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<text class=\"wlIcon-dot\"></text>未使用前 永久 有效\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<view v-else>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<text class=\"wlIcon-dot\"></text>领取后 {{coupon.validity}} 天有效\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</block>\r\n\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"cu-btn sm round line-colour\" @tap=\"onCoupons(index)\" v-if=\"coupon.state\" >\r\n\t\t\t\t\t\t\t\t\t\t\t\t<text v-if=\"coupon.choice\"> 已选择 </text>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<text v-else> 立即使用 </text>\r\n\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"cu-btn sm round\" @tap=\"onReceive(index)\" v-else>\r\n\t\t\t\t\t\t\t\t\t\t\t\t立即领取\r\n\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</scroll-view>\r\n\t\t\t\t\t\t\t<view class=\"foot padding-lr-bj\"><button class=\"cu-btn bg-gradual-orange round text-bold complete\" @tap=\"hideModal\">完成</button></view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"wanlian cu-bar tabbar solid-top foot text-df\">\r\n\t\t\t\t<view>\r\n\t\t\t\t\t<text class=\"wanl-gray\">共{{ orderData.statis.allnum }}件，</text>\r\n\t\t\t\t\t合计：\r\n\t\t\t\t\t<text class=\"text-price text-orange\">{{ orderData.statis.allsub }}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<button v-if=\"loading\" class=\"cu-btn round lg bg-gradual-orange margin-lr-bj\">\r\n\t\t\t\t\t<text class=\"wlIcon-jiazai wlIconfont-spin margin-right-xs\"></text> 提交中...\r\n\t\t\t\t</button>\r\n\t\t\t\t<button v-else @tap=\"addOrder\" class=\"cu-btn round lg bg-gradual-orange margin-lr-bj\"> 提交订单 </button>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tloading: false,\r\n\t\t\ttoken: '',\r\n\t\t\toptionData: {},\r\n\t\t\taddressData: {},\r\n\t\t\tmodalName: null, // 弹出层\r\n\t\t\tcartType: null,\r\n\t\t\tcouponData: {},\r\n\t\t\tcouponIndex: null,\r\n\t\t\torderData: {\r\n\t\t\t\tlists: [],\r\n\t\t\t\tstatis: {\r\n\t\t\t\t\tallnum: 1,\r\n\t\t\t\t\tallsub: 0\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\tonLoad(option) {\r\n\t\tthis.optionData = JSON.parse(option.data);\r\n\t\tthis.loadData();\r\n\t\tthis.cartType = option.type;\r\n\t},\r\n\tmethods: {\r\n\t\tasync loadData(address_id) {\r\n\t\t\tthis.$api.post({\r\n\t\t\t\turl: '/flbooth/order/getOrderGoodsList',\r\n\t\t\t\tloadingTip: '加载中',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tdata: this.optionData,\r\n\t\t\t\t\taddress_id: address_id\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tthis.token = res.token;\r\n\t\t\t\t\tthis.orderData = res.orderData;\r\n\t\t\t\t\tif (res.addressData) {\r\n\t\t\t\t\t\tthis.addressData = res.addressData;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.addAddress('newadd');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 提交订单\r\n\t\tasync addOrder() {\r\n\t\t\tif(this.orderData.statis.allnum === 0){\r\n\t\t\t\tthis.$flbooth.msg('订单异常')\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet address_id = this.addressData.id;\r\n\t\t\tif(address_id === 0){\r\n\t\t\t\tthis.$flbooth.msg('请填写地址')\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet data = {lists: [], address_id: address_id},\r\n\t\t\t\tcart = [];\r\n\t\t\tthis.orderData.lists.forEach((item, index)=> {\r\n\t\t\t\tdata.lists.push({\r\n\t\t\t\t\tshop_id: item.shop_id,\r\n\t\t\t\t\tremarks: item.remarks,\r\n\t\t\t\t\tproducts: [],\r\n\t\t\t\t\t//店铺优惠券和其他 在下追加\r\n\t\t\t\t\tcoupon_id: this.couponData[index] ? this.couponData[index].id : 0\r\n\t\t\t\t});\r\n\t\t\t\titem.products.forEach(goods => {\r\n\t\t\t\t\t// 购物车数据\r\n\t\t\t\t\tcart.push({\r\n\t\t\t\t\t\tgoods_id: goods.id,\r\n\t\t\t\t\t\tsku_id: goods.sku.id\r\n\t\t\t\t\t});\r\n\t\t\t\t\t// 商品数据\r\n\t\t\t\t\tdata.lists[index].products.push({\r\n\t\t\t\t\t\tgoods_id: goods.id,\r\n\t\t\t\t\t\tnumber: goods.number,\r\n\t\t\t\t\t\tsku_id: goods.sku.id,\r\n\t\t\t\t\t\tfreight_id: goods.freight_id\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tthis.loading = true;\r\n\t\t\t// 提交订单数据data\r\n\t\t\tthis.$api.post({\r\n\t\t\t\turl: '/flbooth/order/addOrder',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\torder:data,\r\n\t\t\t\t\ttoken: this.token\r\n\t\t\t\t},\r\n\t\t\t\tloadingTip: '提交订单中...',\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tthis.$store.commit('statistics/order', {\r\n\t\t\t\t\t\tpay: this.$store.state.statistics.order.pay + res.list.length,\r\n\t\t\t\t\t\twhole: this.$store.state.statistics.order.whole + res.list.length\r\n\t\t\t\t\t});\r\n\t\t\t\t\t// 如果使用优惠券全局减去\r\n\t\t\t\t\tlet coupon =  Object.keys(this.couponData).length;\r\n\t\t\t\t\tif (coupon != 0) {\r\n\t\t\t\t\t\tthis.$store.commit('statistics/dynamic', {\r\n\t\t\t\t\t\t\tcoupon: this.$store.state.statistics.dynamic.coupon - coupon\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 大厂软件，就是这么迷幻\r\n\t\t\t\t\tif (this.cartType == 'cart') {\r\n\t\t\t\t\t\tthis.$store.dispatch('cart/del');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.$flbooth.to(`/pages/user/money/pay?token=${res.token}&data=${JSON.stringify(res.list)}`);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t//添加或修改成功之后回调\r\n\t\tasync refreshList(data, type) {\r\n\t\t\tthis.$api.post({\r\n\t\t\t\turl: '/flbooth/address/address',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tdata: data,\r\n\t\t\t\t\ttype: 'add'\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tthis.addressData = res;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 查询优惠券，减缓服务器压力，单独查询（仅查询首次）\r\n\t\tasync queryCoupon(index) {\r\n\t\t\tlet data = this.orderData.lists[index];\r\n\t\t\tif(data.coupon.length == 0){\r\n\t\t\t\tlet goods_id = [];\r\n\t\t\t\tlet shop_category_id = [];\r\n\t\t\t\tfor(var i = 0; i < data.products.length; i++) {\r\n\t\t\t\t\tgoods_id.push(data.products[i]['id']);\r\n\t\t\t\t\tshop_category_id.push(data.products[i]['shop_category_id']);\r\n\t\t\t\t};\r\n\t\t\t\tthis.$api.post({\r\n\t\t\t\t\turl: '/flbooth/coupon/query',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tshop_id: data.shop_id,\r\n\t\t\t\t\t\tgoods_id: this.unique(goods_id),\r\n\t\t\t\t\t\tshop_category_id: this.unique(shop_category_id),\r\n\t\t\t\t\t\tprice: data.order_price\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tdata.coupon = res;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tthis.couponIndex = index;\r\n\t\t\tthis.modalName = 'coupon';\r\n\t\t},\r\n\t\t// 领取优惠券\r\n\t\tasync onReceive(index) {\r\n\t\t\tlet coupon = this.orderData.lists[this.couponIndex].coupon[index];\r\n\t\t\tthis.$api.post({\r\n\t\t\t\turl: '/flbooth/coupon/receive',\r\n\t\t\t\tloadingTip: '领取中',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tid: coupon.id\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tcoupon.id = res.id;\r\n\t\t\t\t\tcoupon.state = true;\r\n\t\t\t\t\tthis.$flbooth.msg(res.msg);\r\n\t\t\t\t\tthis.$store.commit('statistics/dynamic', {\r\n\t\t\t\t\t\tcoupon: this.$store.state.statistics.dynamic.coupon + 1\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 选中优惠券, 将优惠券放进数组中\r\n\t\tonCoupons(index){\r\n\t\t\tlet order = this.orderData.lists[this.couponIndex];\r\n\t\t\tlet data = this.orderData.lists[this.couponIndex].coupon;\r\n\t\t\tdata[index].choice = !data[index].choice;\r\n\t\t\tif(data[index].choice){\r\n\t\t\t\t// 遍历取消掉其他选择的状态，for性能高于其他历遍\r\n\t\t\t\tfor(var i = 0; i < data.length; i++) {\r\n\t\t\t\t\tif(i != index){\r\n\t\t\t\t\t\tdata[i].choice = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t// 更新选择\r\n\t\t\t\tthis.couponData[this.couponIndex] = data[index];\r\n\t\t\t\t// @ 精度计算 this.$flbooth.bcadd('0.132123',0.132123)\r\n\t\t\t\t// 满减计算\r\n\t\t\t\tif (data[index].type == 'reduction' || (data[index].type == 'vip' && data[index].usertype == 'reduction')) {\r\n\t\t\t\t\torder.freight.price = order.freight_price_bak;\r\n\t\t\t\t\torder.sub_price = this.$flbooth.bcsub(this.$flbooth.bcadd(order.order_price, order.freight.price),data[index].price);\r\n\t\t\t\t\tif (order.sub_price < 0) {\r\n\t\t\t\t\t\torder.sub_price = 0.01;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// 折扣计算  前端出问题\r\n\t\t\t\tif (data[index].type == 'discount' || (data[index].type == 'vip' && data[index].usertype == 'discount')) {\r\n\t\t\t\t\tlet discount = data[index].discount > 10 ? this.$flbooth.bcdiv(data[index].discount, 100) : this.$flbooth.bcdiv(data[index].discount, 10);\r\n\t\t\t\t\torder.freight.price = order.freight_price_bak;\r\n\t\t\t\t\torder.sub_price = this.$flbooth.bcadd(this.$flbooth.bcmul(order.order_price, discount), order.freight.price);\r\n\t\t\t\t}\r\n\t\t\t\t// 包邮计算\r\n\t\t\t\tif (data[index].type == 'shipping') {\r\n\t\t\t\t\torder.freight.price = 0;\r\n\t\t\t\t\torder.sub_price = order.order_price;\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\t// 恢复原价 1.0.2升级\r\n\t\t\t\tthis.couponData = {};\r\n\t\t\t\tif (data[index].type == 'shipping') {\r\n\t\t\t\t\torder.freight.price = order.freight_price_bak;\r\n\t\t\t\t}\r\n\t\t\t\torder.sub_price = this.$flbooth.bcadd(order.order_price,order.freight.price);\r\n\t\t\t}\r\n\t\t\t// 精度计算合计\r\n\t\t\tthis.orderData.statis.allsub = 0;\r\n\t\t\tfor(var i = 0; i < this.orderData.lists.length; i++) {\r\n\t\t\t\tthis.orderData.statis.allsub = this.$flbooth.bcadd(this.orderData.statis.allsub, this.orderData.lists[i].sub_price);\r\n\t\t\t};\r\n\t\t\tthis.modalName = null;\r\n\t\t},\r\n\t\t// 修改数量\r\n\t\tchangeNum(num){\r\n\t\t\tnum = num == 0 ? 1 : num;\r\n\t\t\tthis.orderData.lists[0].number = num;\r\n\t\t\tthis.orderData.lists[0].products[0].number = num;\r\n\t\t\tthis.orderData.statis.allnum = num;\r\n\t\t\t// 计算价格\r\n\t\t\tthis.orderData.lists[0].sub_price = this.$flbooth.bcmul(this.orderData.lists[0].products[0].sku.price, num);\r\n\t\t\tthis.orderData.statis.allsub = this.$flbooth.bcmul(this.orderData.lists[0].products[0].sku.price, num);\r\n\t\t},\r\n\t\taddAddress(type) {\r\n\t\t\tthis.$flbooth.to(`/pages/user/address/addressManage?type=${type}`);\r\n\t\t},\r\n\t\tuserAddress() {\r\n\t\t\tthis.$flbooth.to('/pages/user/address/address?source=1');\r\n\t\t},\r\n\t\t// 弹出层，暂时不需要但后续版本可能需要\r\n\t\tshowModal(name) {\r\n\t\t\tthis.modalName = name;\r\n\t\t},\r\n\t\t// 关闭弹出层\r\n\t\thideModal() {\r\n\t\t\tthis.modalName = null;\r\n\t\t},\r\n\t\t// 数组去重并字符串\r\n\t\tunique(arr) {\r\n\t\t\treturn Array.from(new Set(arr)).join(',');\r\n\t\t},\r\n\t\t//禁止父元素滑动\r\n\t\tmoveHandle() {}\r\n\t}\r\n};\r\n</script>\r\n\r\n<style></style>\r\n"],"sourceRoot":""}