(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/apps/find/user/add"],{2280:function(t,e,o){"use strict";(function(t){o("e954");n(o("66fd"));var e=n(o("92aa"));function n(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=o,t(e.default)}).call(this,o("543d")["createPage"])},"451c":function(t,e,o){},"763b":function(t,e,o){"use strict";o.d(e,"b",(function(){return a})),o.d(e,"c",(function(){return r})),o.d(e,"a",(function(){return n}));var n={wanlEmpty:function(){return o.e("components/wanl-empty/wanl-empty").then(o.bind(null,"e5e5"))},uniLoadMore:function(){return o.e("components/uni-load-more/uni-load-more").then(o.bind(null,"1e1f"))}},a=function(){var t=this,e=t.$createElement,o=(t._self._c,"want"===t.params.type?t.__map(t.params.images,(function(e,o){var n=t.__get_orig(e),a=t.params.images.length>0?t.$flbooth.oss(e,100,100):null;return{$orig:n,g0:a}})):null),n="video"===t.params.type&&t.video.progress>0&&100!==t.video.progress?t.$flbooth.conver(t.video.totalBytesSent,!1):null,a="video"===t.params.type&&t.video.progress>0&&100!==t.video.progress?t.$flbooth.conver(t.video.totalBytesExpectedToSend):null,r=t.__map(t.chooseList,(function(e,o){var n=t.__get_orig(e),a=t.chooseList.length>0?t.$flbooth.oss(e.image,100,100):null;return{$orig:n,g3:a}})),i=t.orderList.length>0?t.__map(t.orderList,(function(e,o){var n=t.__get_orig(e),a=t.$flbooth.oss(e.image,100,100);return{$orig:n,g4:a}})):null;t.$mp.data=Object.assign({},{$root:{l0:o,g1:n,g2:a,l1:r,l2:i}})},r=[]},"92aa":function(t,e,o){"use strict";o.r(e);var n=o("763b"),a=o("95da");for(var r in a)"default"!==r&&function(t){o.d(e,t,(function(){return a[t]}))}(r);o("fd64");var i,s=o("f0c5"),l=Object(s["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],i);e["default"]=l.exports},"95da":function(t,e,o){"use strict";o.r(e);var n=o("96fe"),a=o.n(n);for(var r in n)"default"!==r&&function(t){o.d(e,t,(function(){return n[t]}))}(r);e["default"]=a.a},"96fe":function(t,e,o){"use strict";(function(t){function o(t,e){var o;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(o=n(t))||e&&t&&"number"===typeof t.length){o&&(t=o);var a=0,r=function(){};return{s:r,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,l=!1;return{s:function(){o=t[Symbol.iterator]()},n:function(){var t=o.next();return s=t.done,t},e:function(t){l=!0,i=t},f:function(){try{s||null==o.return||o.return()}finally{if(l)throw i}}}}function n(t,e){if(t){if("string"===typeof t)return a(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?a(t,e):void 0}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r={data:function(){return{modalName:null,orderList:[],current_page:1,last_page:1,status:"loading",contentText:{contentdown:"下拉加载更多",contentrefresh:"加载中...",contentnomore:""},chooseList:[],video:{tempFilePath:null,progress:0,totalBytesSent:0,totalBytesExpectedToSend:0},params:{type:null,content:"",goods_ids:[],video_id:null,images:[]}}},onLoad:function(t){this.params.type=t.type},methods:{handleSubmit:function(){var t=this,e=this.params;if("video"===e.type){var o=this.video;if(null===o.tempFilePath||null===e.video_id)return void this.$flbooth.msg("请上传视频");if(0===o.progress)return void this.$flbooth.msg("异常请重开此页面");if(o.progress<100||o.totalBytesSent!==o.totalBytesExpectedToSend)return void this.$flbooth.msg("视频还没有上传完成哦~");if(!e.content)return void this.$flbooth.msg("请编辑视频标题~")}else if("want"===e.type){if(0===e.images.length)return void this.$flbooth.msg("至少添加一张图片");if(!e.content)return void this.$flbooth.msg("请编辑种草详情~")}if(0===e.goods_ids.length)return this.$flbooth.msg("至少选择一个商品"),void this.handleGoods();this.$api.post({url:"/flbooth/find/find/addData",data:e,loadingTip:"发布中...",success:function(e){t.$flbooth.msg("发布成功！"),t.$flbooth.to("/pages/page/success?type=find")}})},handleVideo:function(e){var o=this;t.chooseVideo({success:function(e){var n=e.name?e.name:"".concat(o.$flbooth.guid(12),".mp4");o.$api.get({url:"/flbooth/video/getUploadProof",data:{name:n},success:function(n){var a=t.uploadFile({url:n.ossUrl,filePath:e.tempFilePath,name:n.file,formData:n.formData,success:function(t){200===t.statusCode?(o.params.video_id=n.videoId,o.video.tempFilePath=e.tempFilePath):(o.params.video_id=null,o.video.tempFilePath=null,o.$flbooth.msg("视频点播接口异常"))},fail:function(t){console.info(t)}});a.onProgressUpdate((function(t){o.video.progress=t.progress,o.video.totalBytesSent=t.totalBytesSent,o.video.totalBytesExpectedToSend=t.totalBytesExpectedToSend}))}})}})},handleImage:function(){var e=this;t.chooseImage({crop:{quality:60},success:function(o){e.$api.get({url:"/flbooth/common/uploadData",success:function(n){for(var a=0;a<o.tempFilePaths.length;a++)t.getImageInfo({src:o.tempFilePaths[a],success:function(t){e.$api.upload({url:n.uploadurl,filePath:t.path,name:"file",formData:"local"==n.storage?null:n.multipart,success:function(t){e.params.images.push(t.url)}})}})}})}})},handlePreview:function(e){var n,a=[],r=o(this.params.images);try{for(r.s();!(n=r.n()).done;){var i=n.value;a=a.concat(this.$flbooth.oss(i,500))}}catch(s){r.e(s)}finally{r.f()}t.previewImage({urls:a,current:a[e],indicator:"number"})},handleDelImage:function(t){this.params.images.splice(t,1)},handleUpper:function(){this.last_page===this.current_page?this.status="noMore":(this.status="loading",this.current_page++,this.handleGoods("upper"))},handleGoods:function(t){var e=this;this.modalName="goods",this.orderList.length>0&&"upper"!==t||this.$api.get({url:"/flbooth/order/getBuyList",data:{page:this.current_page},success:function(o){e.last_page=o.last_page,e.current_page=o.current_page,o.last_page===o.current_page?e.status="noMore":e.status="more",0===o.total&&(e.status="noMore"),e.orderList="upper"===t?e.orderList.concat(o.data):o.data}})},handleHideModal:function(){this.modalName=null},handleChoose:function(t){if(this.chooseList.length>=8)this.$flbooth.msg("最多选择 8 个商品");else{var e=this.orderList[t];e.choose?e.choose=!1:this.$set(e,"choose",!0),this.formatGoods()}},formatGoods:function(){var t=[],e=[];this.orderList.map((function(o){o.choose&&(t.push(o),e.push(o.id))})),this.chooseList=t,this.params.goods_ids=e},onEditorInput:function(t){this.params.content=t.detail.html},onEditorReady:function(){var e=this;t.createSelectorQuery().select("#editor").context((function(t){e.editorCtx=t.context})).exec()}}};e.default=r}).call(this,o("543d")["default"])},fd64:function(t,e,o){"use strict";var n=o("451c"),a=o.n(n);a.a}},[["2280","common/runtime","common/vendor"]]]);