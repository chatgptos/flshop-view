(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/qrcode/qrcode"],{"0c1a":function(t,e,a){"use strict";var n=a("440d"),o=a.n(n);o.a},"2cdf0":function(t,e,a){"use strict";a.r(e);var n=a("50a8"),o=a("d6a0");for(var c in o)"default"!==c&&function(t){a.d(e,t,(function(){return o[t]}))}(c);a("0c1a");var s,r=a("f0c5"),i=Object(r["a"])(o["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);e["default"]=i.exports},"2efc":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=c(a("a34a")),o=c(a("a2ed"));function c(t){return t&&t.__esModule?t:{default:t}}function s(t,e,a,n,o,c,s){try{var r=t[c](s),i=r.value}catch(u){return void a(u)}r.done?e(i):Promise.resolve(i).then(n,o)}function r(t){return function(){var e=this,a=arguments;return new Promise((function(n,o){var c=t.apply(e,a);function r(t){s(c,n,o,r,i,"next",t)}function i(t){s(c,n,o,r,i,"throw",t)}r(void 0)}))}}var i={data:function(){return{QRCodeText:"",QRCodeSrc:"",posterSrc:"",postercanvas_width:0,postercanvas_height:0,posterTemplates:[]}},onLoad:function(e){t.showLoading({title:"二维码生成中",mask:!0}),e.url?this.QRCodeText=e.url:this.QRCodeText=this.$store.state.common.appConfig.domain+"&QRtype=user",this.loadData()},methods:{loadData:function(e){var a=this;return r(n.default.mark((function e(){return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a.$api.post({url:"/flbooth/common/qrcode",success:function(e){e.forEach((function(e,n,o){"flboothqr"!=e.template&&(t.downloadFile({url:a.$flbooth.oss(e.background_url,350,0),success:function(t){e.background_url=t.tempFilePath}}),t.downloadFile({url:a.$flbooth.oss(e.logo_src,40,40),success:function(t){e.logo_src=t.tempFilePath}}))})),a.posterTemplates=e,0==e.length?t.showModal({title:"重要提示",content:"平台尚未配置二维码，请到后台系统管理【配置二维码】",success:function(t){a.$flbooth.back(1)}}):t.showLoading({title:"加载配置中",mask:!0}),o.default.make({canvasId:"qrcode",text:a.QRCodeText,size:200,success:function(t){a.QRCodeSrc=t,a.create(a.posterTemplates[0])}})}});case 1:case"end":return e.stop()}}),e)})))()},create:function(e){var a=this;e.checked||(t.showLoading({title:"海报生成中",mask:!0}),this.posterTemplates.forEach((function(t){t.checked=!1})),e.checked=!0,this.postercanvas_width=e.canvas_width,this.postercanvas_height=e.canvas_height,this.posterSrc="",setTimeout((function(){switch(e.template){case"flboothqrlist001":a.flboothqrlist001({canvasId:"poster",canvas_width:e.canvas_width,canvas_height:e.canvas_height,backgroundSrc:e.background_url,logoSrc:e.logo_src,name:a.$store.state.user.username,text:"长按扫描二维码~",QRCodeSrc:a.QRCodeSrc,success:function(e){a.posterSrc=e,t.hideLoading()}});break;case"flboothqr":a.flboothqr({canvasId:"poster",canvas_width:e.canvas_width,canvas_height:e.canvas_height,QRCodeSrc:a.QRCodeSrc,success:function(e){a.posterSrc=e,t.hideLoading()}});break}}),100))},save:function(){var e=this;t.saveImageToPhotosAlbum({filePath:this.posterSrc,success:function(){e.$flbooth.msg("保存成功")}})},flboothqrlist001:function(e){var a=e.canvas_width,n=e.canvas_height,o=e.backgroundSrc,c=e.logoSrc,s=e.name,r=e.text,i=e.QRCodeSrc,u=t.createCanvasContext(e.canvasId);u.clearRect(0,0,a,n);var l={width:"500",height:"667"},d=a,f=l.height*a/l.width;u.drawImage(o,0,0,d,f);var h=80,v=80,p=36,g=f+(n-f)/2-v/2;u.save(),u.beginPath(),u.arc(h/2+p,v/2+g,h/2,0,2*Math.PI,!1),u.closePath(),u.clip(),u.drawImage(c,p,g,h,v),u.restore(),s.length>10&&(s=s.substring(0,10)+"...");var m=p+h+10,_=g+32,b=20;u.setFillStyle("#000000"),u.setFontSize(b),u.fillText(s,m,_);var w=m,S=_+32,k=16;u.setFillStyle("#999999"),u.setFontSize(k),u.fillText(r,w,S);var T=100,C=100,I=a-T-36,P=f+(n-f)/2-C/2;u.drawImage(i,I,P,T,C),u.draw(!1,(function(){t.canvasToTempFilePath({canvasId:e.canvasId,fileType:"jpg",success:function(t){e.success&&e.success(t.tempFilePath)}})}))},flboothqr:function(e){var a=e.canvas_width,n=e.canvas_height,o=e.QRCodeSrc,c=t.createCanvasContext(e.canvasId);c.clearRect(0,0,a,n),c.drawImage(o,15,15,a-30,n-30),c.draw(!1,(function(){t.canvasToTempFilePath({canvasId:e.canvasId,fileType:"jpg",success:function(t){e.success&&e.success(t.tempFilePath)}})}))}}};e.default=i}).call(this,a("543d")["default"])},"440d":function(t,e,a){},"50a8":function(t,e,a){"use strict";var n;a.d(e,"b",(function(){return o})),a.d(e,"c",(function(){return c})),a.d(e,"a",(function(){return n}));var o=function(){var t=this,e=t.$createElement,a=(t._self._c,t.__map(t.posterTemplates,(function(e,a){var n=t.__get_orig(e),o=t.$flbooth.oss(e.thumbnail_url,0,88);return{$orig:n,g0:o}})));t.$mp.data=Object.assign({},{$root:{l0:a}})},c=[]},d6a0:function(t,e,a){"use strict";a.r(e);var n=a("2efc"),o=a.n(n);for(var c in n)"default"!==c&&function(t){a.d(e,t,(function(){return n[t]}))}(c);e["default"]=o.a},e179:function(t,e,a){"use strict";(function(t){a("e954");n(a("66fd"));var e=n(a("2cdf0"));function n(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=a,t(e.default)}).call(this,a("543d")["createPage"])}},[["e179","common/runtime","common/vendor"]]]);