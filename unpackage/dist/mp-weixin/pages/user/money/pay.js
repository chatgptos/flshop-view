(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/money/pay"],{1399:function(e,t,o){"use strict";(function(e){o("e954");n(o("66fd"));var t=n(o("f7d3"));function n(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=o,e(t.default)}).call(this,o("543d")["createPage"])},3310:function(e,t,o){},"75e0":function(e,t,o){"use strict";o.r(t);var n=o("83f8"),r=o.n(n);for(var s in n)"default"!==s&&function(e){o.d(t,e,(function(){return n[e]}))}(s);t["default"]=r.a},"83f8":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(o("a34a")),r=o("26cb");function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t,o,n,r,s,a){try{var c=e[s](a),i=c.value}catch(u){return void o(u)}c.done?t(i):Promise.resolve(i).then(n,r)}function c(e){return function(){var t=this,o=arguments;return new Promise((function(n,r){var s=e.apply(t,o);function c(e){a(s,n,r,c,i,"next",e)}function i(e){a(s,n,r,c,i,"throw",e)}c(void 0)}))}}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function u(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){d(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function d(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var p={data:function(){return{token:"",disabled:!1,price:"0.00",isbalance:!1,order_type:"goods",order_no:"",order_pay_no:"",payNum:1,payList:[]}},computed:u({},(0,r.mapState)(["user"])),watch:{price:function(e,t){e<=parseFloat(this.$store.state.user.money)&&(this.isbalance=!0,this.getPayment())}},onLoad:function(t){var o=this;if(this.$api.post({url:"/flbooth/pay/getBalance",success:function(e){o.$store.commit("user/setUserInfo",{money:e}),o.getPayment()}}),t.data){var n=0,r=JSON.parse(t.data),s=[];r.length<=1?(this.price=r[0].price,this.order_type=r[0].type,this.order_no="".concat("groups"==r[0].type?"拼团":"","订单号：").concat(r[0].order_no),this.order_pay_no=r[0].pay_no,this.order_id=r[0].order_id):(r.forEach((function(e){n=o.$flbooth.bcadd(n,e.price),s.push(e.order_id)})),this.price=n,this.order_id=s,this.payNum=r.length,this.order_no="合并支付 "+r.length+"个订单"),this.token=t.token}else t.order_id?(e.showLoading({title:"结算中..."}),this.$api.post({url:"/flbooth/pay/getPay",data:{order_id:t.order_id,order_type:t.order_type},success:function(t){e.hideLoading(),o.token=t.token,o.price=t.price,o.order_type=t.order_type,o.order_no="".concat("groups"==t.order_type?"拼团":"","订单号：").concat(t.order_no),o.order_pay_no=t.pay_no,o.order_id=t.order_id}})):console.log("非法访问")},methods:{getPayment:function(){var t=this,o="wap";o="miniapp",this.payList=[{name:"余额支付",describe:"",type:"balance",method:"balance",state:!!this.isbalance,select:!!this.isbalance}],e.getProvider({service:"payment",success:function(e){e.provider.map((function(e){"alipay"==e?t.payList.push({name:"支付宝",describe:"",type:e,method:o,state:!0,select:!1}):"wxpay"==e?t.payList.push({name:"微信支付",describe:"推荐使用微信支付",type:"wechat",method:o,state:!0,select:!t.isbalance}):"baidu"==e?t.payList.push({name:"百度收银台",describe:"",type:e,method:o,state:!0,select:!1}):"appleiap"==e&&t.payList.push({name:"Apple支付",describe:"",type:"apple",method:o,state:!0,select:!1})}))}})},confirm:function(){var t=this,o=null;this.disabled||(this.payList.map((function(e,t,n){e.select&&(o=e)})),o?(this.disabled=!0,e.login({success:function(e){t.wanlPay(o,e.code)},fail:function(t){e.showModal({content:"无法获取微信code,原因为: "+t.errMsg,showCancel:!1})}})):e.showModal({content:"请选择支付方式",showCancel:!1}))},wanlPay:function(t){var o=arguments,r=this;return c(n.default.mark((function s(){var a;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:a=o.length>1&&void 0!==o[1]?o[1]:null,r.$api.post({url:"/flbooth/pay/payment",data:{order_type:r.order_type,type:t.type,method:t.method,code:a,order_id:r.order_id,token:r.token},success:function(o){switch(t.type){case"balance":r.$store.commit("user/setUserInfo",{money:r.$flbooth.bcsub(r.$store.state.user.money,r.price)}),r.paySuccess();break;case"wechat":"wap"==t.method?(setTimeout((function(){e.showModal({content:"请确认微信支付是否已完成",confirmText:"已完成",cancelText:"重新支付",success:function(e){e.confirm?r.paySuccess():e.cancel&&r.confirm()}})}),2e3),window.location.href=o):"app"==t.method?e.requestPayment({provider:"wxpay",orderInfo:o,success:function(e){console.log("success",e),r.paySuccess()},fail:function(t){e.showModal({content:"支付失败,原因为: "+t.errMsg,showCancel:!1})},complete:function(){r.disabled=!1}}):"miniapp"==t.method?e.requestPayment({appId:o.appId,nonceStr:o.nonceStr,package:o.package,paySign:o.paySign,signType:o.signType,timeStamp:o.timeStamp,success:function(e){r.paySuccess()},fail:function(t){e.showModal({content:"支付失败,原因为: "+t.errMsg,showCancel:!1})}}):"mp"==t.method&&r.$jssdk.wxpay({data:o,success:function(e){r.paySuccess()},fail:function(e){"chooseWXPay:ok"==e.errMsg?r.$flbooth.msg("支付成功"):"chooseWXPay:cancel"==e.errMsg?r.$flbooth.msg("支付失败，取消支付"):"chooseWXPay:fail"==e.errMsg&&r.$flbooth.msg("支付失败")}});break;case"alipay":"wap"==t.method?(r.disabled=!1,"goods"===r.order_type&&r.$store.commit("statistics/order",{pay:r.$flbooth.bcsub(r.$store.state.statistics.order.pay,r.payNum),delive:r.$flbooth.bcadd(r.$store.state.statistics.order.delive,r.payNum)}),document.write(o)):"app"==t.method&&e.requestPayment({provider:"alipay",orderInfo:o,success:function(e){console.log("success",e),r.paySuccess()},fail:function(t){e.showModal({content:"支付失败,原因为: "+t.errMsg,showCancel:!1})},complete:function(){r.disabled=!1}});break}}});case 2:case"end":return n.stop()}}),s)})))()},onSelect:function(e){this.payList.map((function(t,o,n){t.select=o==e&&!t.select}))},paySuccess:function(){this.disabled=!1,"goods"===this.order_type&&this.$store.commit("statistics/order",{pay:this.$flbooth.bcsub(this.$store.state.statistics.order.pay,this.payNum),delive:this.$flbooth.bcadd(this.$store.state.statistics.order.delive,this.payNum)}),this.$flbooth.to("/pages/page/success?type=pay&order_type=".concat(this.order_type?this.order_type:"goods"))}}};t.default=p}).call(this,o("543d")["default"])},b332:function(e,t,o){"use strict";var n;o.d(t,"b",(function(){return r})),o.d(t,"c",(function(){return s})),o.d(t,"a",(function(){return n}));var r=function(){var e=this,t=e.$createElement;e._self._c},s=[]},e223:function(e,t,o){"use strict";var n=o("3310"),r=o.n(n);r.a},f7d3:function(e,t,o){"use strict";o.r(t);var n=o("b332"),r=o("75e0");for(var s in r)"default"!==s&&function(e){o.d(t,e,(function(){return r[e]}))}(s);o("e223");var a,c=o("f0c5"),i=Object(c["a"])(r["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],a);t["default"]=i.exports}},[["1399","common/runtime","common/vendor"]]]);