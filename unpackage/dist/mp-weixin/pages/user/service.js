(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/service"],{"0172":function(t,i,e){},"693c":function(t,i,e){"use strict";var s=e("0172"),o=e.n(s);o.a},"6b7d":function(t,i,e){"use strict";(function(t){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var s=o(e("a34a"));function o(t){return t&&t.__esModule?t:{default:t}}function n(t,i,e,s,o,n,r){try{var a=t[n](r),c=a.value}catch(u){return void e(u)}a.done?i(c):Promise.resolve(c).then(s,o)}function r(t){return function(){var i=this,e=arguments;return new Promise((function(s,o){var r=t.apply(i,e);function a(t){n(r,s,o,a,c,"next",t)}function c(t){n(r,s,o,a,c,"throw",t)}a(void 0)}))}}var a=e("5993"),c={data:function(){return{user_id:this.$store.state.user.id,avatar:this.$store.state.user.avatar,nickname:this.$store.state.user.nickname,to_id:0,textMsg:"",scrollAnimation:!1,scrollTop:0,scrollToView:"",msgList:[],msgImgList:[],emptybottom:!1,RECORDER:t.getRecorderManager(),isVoice:!1,voiceTis:"按住 说话",recordTis:"手指上滑 取消发送",recording:!1,willStop:!1,initPoint:{identifier:0,Y:0},recordTimer:null,recordLength:0,AUDIO:t.createInnerAudioContext(),playMsgid:null,VoiceTimer:null,popupLayerClass:!1,hideMore:!0,TabCur:"默认",hideEmoji:!0,emojiList:this.emojiData(),QnUrl:""}},onLoad:function(i){var e=this;this.loadData(),this.AUDIO.onEnded((function(t){e.playMsgid=null})),this.RECORDER.onStart((function(t){e.recordBegin(t)})),this.RECORDER.onStop((function(t){e.recordEnd(t)})),t.$on("onService",this.onChat)},onShow:function(){this.scrollTop=9999999},methods:{loadData:function(){var t=this;return r(s.default.mark((function i(){return s.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:t.$api.post({url:"/flbooth/chat/hello",data:{id:1,type:"service",form_id:t.user_id}});case 1:case"end":return i.stop()}}),i)})))()},sendMsg:function(t,i){var e=2;this.msgList.length&&(e=this.msgList[this.msgList.length-1].id,e++);var s={id:e,type:"service",to_id:this.to_id,form:{id:this.user_id,avatar:this.avatar,name:this.nickname},message:{type:i,content:t},created:parseInt((new Date).getTime()/1e3)};this.onChat(JSON.parse(JSON.stringify(s)),!0),this.$api.post({url:"/flbooth/chat/service",data:s})},onChat:function(t,i){var e=this;i||(this.to_id=t.form.id,t.form.hasOwnProperty("name")&&this.$flbooth.title(t.form.name)),"list"==t.message.type&&this.addListMsg(t),"article"==t.message.type&&this.addArticleMsg(t),"text"==t.message.type&&this.addTextMsg(t),"voice"==t.message.type&&this.addVoiceMsg(t),"img"==t.message.type&&this.addImgMsg(t),"end"==t.message.type&&this.$flbooth.msg(t.message.content),this.$nextTick((function(){e.scrollToView="msg"+t.id}))},addListMsg:function(t){this.msgList.push(t)},addArticleMsg:function(t){this.msgList.push(t)},addTextMsg:function(t){t.message.content.text=this.replaceEmoji(t.message.content.text),this.msgList.push(t)},addVoiceMsg:function(t){this.msgList.push(t)},addImgMsg:function(t){t.message.content=this.setPicSize(t.message.content),this.msgImgList.push(t.message.content.url),this.msgList.push(t)},chooseImage:function(){this.getImage("album")},camera:function(){this.getImage("camera")},getImage:function(i){var e=this;this.hideDrawer(),t.chooseImage({sourceType:[i],sizeType:["original","compressed"],success:function(i){e.$api.get({url:"/flbooth/common/uploadData",success:function(s){for(var o=0;o<i.tempFilePaths.length;o++)t.getImageInfo({src:i.tempFilePaths[o],success:function(t){e.$api.upload({url:s.uploadurl,filePath:t.path,name:"file",formData:"local"==s.storage?null:s.multipart,success:function(i){e.sendMsg({url:i.fullurl,w:t.width,h:t.height},"img")}})}})}})}})},sendText:function(){if(this.hideDrawer(),this.textMsg){var t={text:this.textMsg};this.sendMsg(t,"text"),this.textMsg=""}},aiSend:function(t){this.sendMsg({text:t},"text")},showPic:function(i){t.previewImage({indicator:"none",current:i.content.url,urls:this.msgImgList})},playVoice:function(t){var i=this;this.playMsgid=t.id,this.AUDIO.src=t.content.url,this.$nextTick((function(){i.AUDIO.play()}))},voiceBegin:function(t){t.touches.length>1||(this.initPoint.Y=t.touches[0].clientY,this.initPoint.identifier=t.touches[0].identifier,this.RECORDER.start({format:"mp3"}))},recordBegin:function(t){var i=this;this.recording=!0,this.voiceTis="松开 结束",this.recordLength=0,this.recordTimer=setInterval((function(){i.recordLength++}),1e3)},voiceCancel:function(){this.recording=!1,this.voiceTis="按住 说话",this.recordTis="手指上滑 取消发送",this.willStop=!0,this.RECORDER.stop()},voiceIng:function(i){if(this.recording){var e=i.touches[0];this.initPoint.Y-e.clientY>=t.upx2px(200)?(this.willStop=!0,this.recordTis="松开手指 取消发送"):(this.willStop=!1,this.recordTis="手指上滑 取消发送")}},voiceEnd:function(t){this.recording&&(this.recording=!1,this.voiceTis="按住 说话",this.recordTis="手指上滑 取消发送",this.RECORDER.stop())},recordEnd:function(t){var i=this;clearInterval(this.recordTimer),this.willStop?console.log("取消发送录音"):(this.$api.get({url:"/flbooth/common/uploadData",success:function(e){i.$api.upload({url:e.uploadurl,filePath:t.tempFilePath,name:"file",formData:"local"==e.storage?null:e.multipart,success:function(t){var e={length:0,url:t.fullurl};e.length=i.recordLength%60,e.length>0&&i.sendMsg(e,"voice")}})}}),console.log("录音结束")),this.willStop=!1},switchVoice:function(){this.hideDrawer(),this.isVoice=!this.isVoice},emojiData:function(){var t={},i=[],e={};return a.forEach((function(s){var o=s.category.length>0?s.category:"默认";t[o]||(t[o]=[],i.push(o)),t[o].push(s),e[s.phrase]=s.icon})),{groups:t,categories:i,map:e}},replaceEmoji:function(t){var i=this,e=t.replace(/\[([^(\]|\[)]*)\]/g,(function(t,e){return'<img src="'+i.emojiList.map[t]+'" width="18rpx">'}));return e.replace(/(\r\n)|(\n)/g,"<br>")},tabSelect:function(t){this.TabCur=t.currentTarget.dataset.id},setPicSize:function(i){var e=t.upx2px(350),s=t.upx2px(350);if(i.w>e||i.h>s){var o=i.w/i.h;i.w=o>1?e:s*o,i.h=o>1?e/o:s}return i},showMore:function(){this.isVoice=!1,this.hideEmoji=!0,this.hideMore?(this.hideMore=!1,this.openDrawer()):this.hideDrawer()},openDrawer:function(){this.emptybottom=!0,this.popupLayerClass=!0},hideDrawer:function(){var t=this;this.emptybottom=!1,this.popupLayerClass=!1,setTimeout((function(){t.hideMore=!0,t.hideEmoji=!0}),150)},chooseEmoji:function(){this.hideMore=!0,this.hideEmoji?(this.hideEmoji=!1,this.openDrawer()):this.hideDrawer()},addEmoji:function(t){this.textMsg+=t},textareaFocus:function(){this.emptybottom=!0,this.popupLayerClass&&0==this.hideMore&&this.hideDrawer()},textareaBlur:function(){this.emptybottom=!1},discard:function(){}}};i.default=c}).call(this,e("543d")["default"])},"9aad":function(t,i,e){"use strict";e.r(i);var s=e("6b7d"),o=e.n(s);for(var n in s)"default"!==n&&function(t){e.d(i,t,(function(){return s[t]}))}(n);i["default"]=o.a},afe3:function(t,i,e){"use strict";e.r(i);var s=e("d3da"),o=e("9aad");for(var n in o)"default"!==n&&function(t){e.d(i,t,(function(){return o[t]}))}(n);e("693c");var r,a=e("f0c5"),c=Object(a["a"])(o["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],r);i["default"]=c.exports},d3da:function(t,i,e){"use strict";var s;e.d(i,"b",(function(){return o})),e.d(i,"c",(function(){return n})),e.d(i,"a",(function(){return s}));var o=function(){var t=this,i=t.$createElement,e=(t._self._c,t.__map(t.msgList,(function(i,e){var s=t.__get_orig(i),o=i.form.id==t.user_id?t.$flbooth.oss(i.form.avatar,44,44,2,"avatar"):null,n=i.form.id!=t.user_id&&i.form.avatar?t.$flbooth.oss(i.form.avatar):null,r=i.form.id==t.user_id||i.form.avatar?null:t.$flbooth.appstc("/common/logo.png"),a=i.form.id!=t.user_id?t.$flbooth.timeToChat(i.created):null;return{$orig:s,g0:o,g1:n,g2:r,g3:a}})));t.$mp.data=Object.assign({},{$root:{l0:e}})},n=[]},dd6c:function(t,i,e){"use strict";(function(t){e("e954");s(e("66fd"));var i=s(e("afe3"));function s(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=e,t(i.default)}).call(this,e("543d")["createPage"])}},[["dd6c","common/runtime","common/vendor"]]]);